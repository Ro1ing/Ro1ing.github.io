{"posts":[{"fileName":"westernctf2018shrine","abstract":"<pre><code class=\"language-python\">import flask\nimport os\napp = flask.Flask(__name__)\napp.config['FLAG'] = os.environ.pop('FLAG')\n@app.route('/')\ndef index():\n    return open(__file__).read()\n@app.route('/shrine/&lt;path:shrine&gt;')\ndef shrine(shrine):\ndef safe_jinja(s):\n        s = s.replace('(', '').replace(')', '')\n        blacklist = ['config', 'self']\n        return ''.join(['{{% set {}=None%}}'.format(c) for c in blacklist]) + s\nreturn flask.render_template_string(safe_jinja(shrine))\nif __name__ == '__main__':\n    app.run(debug=True)\n</code></pre>\n<p>题目出现这个</p>\n<p><strong>flask引擎-jinja2模板注入</strong></p>\n<p>利用tplmap这个工具进行检测是否有模板注入漏洞</p>\n<pre><code>python tplmap.py -u \n</code></pre>\n<p><img src=\"\" alt=\"\" loading=\"lazy\"><img src=\"https://Ro1ing.github.io/post-images/1611987920309.png\" alt=\"\" loading=\"lazy\"></p>\n<blockquote>\n<p>Automatic Server-Side Template Injection Detection and Expleion tool [checks] Tested parameters appear to be not injectable<br>\n翻译：<br>\n服务器端模板自动注入检测和删除离子工具！][检查经过测试的参数似乎无法注入</p>\n</blockquote>\n<p><strong>模板渲染接受的参数需要用两个大括号括起来{ { } }</strong></p>\n<p>模板注入也在大括号里构造</p>\n<p><img src=\"https://Ro1ing.github.io/post-images/1611987954881.png\" alt=\"\" loading=\"lazy\"><br>\n在shrine路径下 ssti注入能运行</p>\n<p>回头看下源码</p>\n<pre><code>app.config['FLAG'] = os.environ.pop('FLAG')\n</code></pre>\n<p>注册了一个名为FLAG的config，猜测这就是flag，</p>\n<p><strong>如果没有过滤可以直接{{config}}即可查看所有app.config内容</strong></p>\n<p>推测{{config}}可查看所有app.config内容，但是这题设了黑名单[‘config’,‘self’]并且过滤了括号</p>\n<p>不过python还有一些内置函数，比如url_for和get_flashed_messages</p>\n<blockquote>\n<p>/shrine/{{url_for.<strong>globals</strong>}}</p>\n</blockquote>\n<p><img src=\"3.png\" alt=\"\" loading=\"lazy\"><br>\n<img src=\"https://Ro1ing.github.io/post-images/1611987966420.png\" alt=\"\" loading=\"lazy\"><br>\ncurrent_app-当前app，查看当下app中的config</p>\n<p><img src=\"4.png\" alt=\"\" loading=\"lazy\"><br>\n<img src=\"https://Ro1ing.github.io/post-images/1611987971566.png\" alt=\"\" loading=\"lazy\"><br>\n得到flag</p>\n<p>知识点：</p>\n<p><strong>SSTI模板注入：</strong></p>\n<p><img src=\"5.png\" alt=\"\" loading=\"lazy\"><br>\n<img src=\"https://Ro1ing.github.io/post-images/1611987976487.png\" alt=\"\" loading=\"lazy\"><br>\n模板注入涉及的是服务端Web应用使用模板引擎渲染用户请求的过程</p>\n<p>服务端把用户输入的内容渲染成模板就可能造成SSTI(Server-Side Template Injection)</p>\n<p>引擎有不同的测试以及注入方式！</p>\n","description":"import flask import os app = flask.Flask(__name__) app.config['FLAG'] = os.environ.pop('FLAG') @app.route('/') def index...","title":"[WesternCTF2018]shrine","tags":[],"feature":"","link":"https://Ro1ing.github.io/post/westernctf2018shrine/","stats":{"text":"2 min read","time":102000,"words":402,"minutes":2},"isTop":false,"toc":"","date":"2021-01-30 14:24:00","dateFormat":"2021-01-30"},{"fileName":"hu-wang-bei-2018easy_tornado","abstract":"","description":"都打开看看 /flag. txt flag in/flllllllag /welcome. txt render /hints. txt md5(cookie_secret+md5(filename) ) render()函数详...","title":"[护网杯2018]easy_tornado","tags":[{"name":"SSTI","slug":"yrTjWm0vw","used":true,"link":"https://Ro1ing.github.io/tag/yrTjWm0vw/"},{"name":"CTF","slug":"V2wZv9aoze","used":true,"link":"https://Ro1ing.github.io/tag/V2wZv9aoze/"}],"feature":"","link":"https://Ro1ing.github.io/post/hu-wang-bei-2018easy_tornado/","stats":{"text":"2 min read","time":87000,"words":350,"minutes":2},"isTop":false,"toc":"","date":"2021-01-30 14:21:08","dateFormat":"2021-01-30"},{"fileName":"ji-ke-da-tiao-zhan-2019lovesql","abstract":"","description":"用户登录界面 尝试使用万能密码 admin/1'or'1'='1 测试单引号' 观察是否有报错信息 这里我就可以知道为 字符型注入 如果是整形 报错信息为“12’” 所以我们要使用到闭合语句来完成 字符型和数字型最大的一个区别在于，数...","title":"[极客大挑战 2019]LoveSQL","tags":[{"name":"SQL","slug":"zrXv1HrkU","used":true,"link":"https://Ro1ing.github.io/tag/zrXv1HrkU/"},{"name":"CTF","slug":"V2wZv9aoze","used":true,"link":"https://Ro1ing.github.io/tag/V2wZv9aoze/"}],"feature":"","link":"https://Ro1ing.github.io/post/ji-ke-da-tiao-zhan-2019lovesql/","stats":{"text":"2 min read","time":92000,"words":366,"minutes":2},"isTop":false,"toc":"","date":"2021-01-30 14:20:14","dateFormat":"2021-01-30"},{"fileName":"buuctf-web","abstract":"","description":"代码审计 查看一下useless.php --只有注释信息 没有用 利用data协议绕过 将welcome to the zjctf写入 而data://协议允许读入 payload： text=data://text/plain;bas...","title":" [ZJCTF 2019]NiZhuanSiWei","tags":[{"name":"PHP","slug":"T4AXz5C92","used":true,"link":"https://Ro1ing.github.io/tag/T4AXz5C92/"},{"name":"反序列化","slug":"a1PMNYby40","used":true,"link":"https://Ro1ing.github.io/tag/a1PMNYby40/"},{"name":"CTF","slug":"V2wZv9aoze","used":true,"link":"https://Ro1ing.github.io/tag/V2wZv9aoze/"}],"feature":"","link":"https://Ro1ing.github.io/post/buuctf-web/","stats":{"text":"2 min read","time":107000,"words":364,"minutes":2},"isTop":false,"toc":"","date":"2021-01-30 14:10:35","dateFormat":"2021-01-30"},{"fileName":"jing-tai-wang-zhan-he-dong-tai-wang-zhan-de-qu-bie","abstract":"","description":"静态网站：没有进行数据交互的网页，不支持数据传输，页面后缀一般是“.html”。 静态网站是最初的建站方式，浏览者所看到的每个页面是建站者上传到服务器上的一个 html （ htm ）文件，这种网站每增加、删除、修改一个页面，都必须重新对...","title":"静态网站和动态网站的区别","tags":[],"feature":"","link":"https://Ro1ing.github.io/post/jing-tai-wang-zhan-he-dong-tai-wang-zhan-de-qu-bie/","stats":{"text":"6 min read","time":340000,"words":1669,"minutes":6},"isTop":false,"toc":"","date":"2021-01-30 14:06:27","dateFormat":"2021-01-30"},{"fileName":"shen-tou-ji-chu-xue-xi-bi-ji","abstract":"","description":"主机发现学习笔记(一) 首先先要了解协议中的栈分层 OSI （Open System Interconnect），即开放式系统互联。 应用层：给应用提供服务。 表示层：确保从设备的应用层发出的数据可以被另一个设备应用层理解，把文件...","title":"渗透基础学习笔记","tags":[{"name":"渗透","slug":"sqXwxlM5K","used":true,"link":"https://Ro1ing.github.io/tag/sqXwxlM5K/"}],"feature":"","link":"https://Ro1ing.github.io/post/shen-tou-ji-chu-xue-xi-bi-ji/","stats":{"text":"24 min read","time":1389000,"words":6422,"minutes":24},"isTop":false,"toc":"<ul class=\"markdownIt-TOC\">\n<li><a href=\"#%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%80\">主机发现学习笔记(一)</a>\n<ul>\n<li><a href=\"#%E4%BA%8C%E5%B1%82%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0\">二层主机发现</a>\n<ul>\n<li><a href=\"#%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7\">扫描工具</a></li>\n</ul>\n</li>\n<li><a href=\"#%E4%B8%89%E5%B1%82%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0\">三层主机发现</a>\n<ul>\n<li><a href=\"#%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7-2\">扫描工具</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%9B%9B%E5%B1%82%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0\">四层主机发现</a>\n<ul>\n<li><a href=\"#%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7-3\">扫描工具</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%80\">漏洞扫描学习笔记(一)</a>\n<ul>\n<li><a href=\"#%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F%E5%8E%9F%E7%90%86\"><strong>漏洞扫描原理</strong></a>\n<ul>\n<li><a href=\"#%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7\">漏洞扫描工具</a></li>\n</ul>\n</li>\n<li><a href=\"#web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F\">web应用程序漏洞扫描</a>\n<ul>\n<li><a href=\"#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8\">漏洞利用</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%80\">端口扫描学习笔记(一)</a>\n<ul>\n<li><a href=\"#%E7%AB%AF%E5%8F%A3%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D\">端口的基本介绍</a></li>\n<li><a href=\"#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7\">端口扫描工具</a></li>\n<li><a href=\"#%E7%AB%AF%E5%8F%A3%E5%88%86%E7%B1%BB\">端口分类</a>\n<ul>\n<li><a href=\"#%E8%8E%B7%E5%8F%96%E7%AB%AF%E5%8F%A3banner%E4%BF%A1%E6%81%AF%E5%B7%A5%E5%85%B7\">获取端口Banner信息工具</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#http%E5%8D%8F%E8%AE%AE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%80\">Http协议学习笔记(一)</a><br>\n*<br>\n*<br>\n* <a href=\"#%E4%BB%80%E4%B9%88%E6%98%AFhttp\">什么是HTTP？</a><br>\n* <a href=\"#%E4%BB%80%E4%B9%88%E6%98%AFhttps\">什么是HTTPS？</a></li>\n<li><a href=\"#windows%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%80\">Windows基础学习笔记(一)</a>\n<ul>\n<li><a href=\"#c%E7%9B%98%E6%A0%B9%E7%9B%AE%E5%BD%95%E5%B8%B8%E8%A7%81%E6%96%87%E4%BB%B6%E5%A4%B9\">C盘根目录常见文件夹</a>\n<ul>\n<li><a href=\"#system32-%E4%BF%9D%E5%AD%98%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\"><strong>system32</strong> --保存系统的配置文件</a></li>\n</ul>\n</li>\n<li><a href=\"#windows%E5%B8%B8%E8%A7%81%E6%9C%8D%E5%8A%A1\">Windows常见服务</a></li>\n</ul>\n</li>\n</ul>\n","date":"2021-01-30 13:27:06","dateFormat":"2021-01-30"}],"tags":[{"name":"SSTI","slug":"yrTjWm0vw","used":true,"link":"https://Ro1ing.github.io/tag/yrTjWm0vw/","count":1},{"name":"CTF","slug":"V2wZv9aoze","used":true,"link":"https://Ro1ing.github.io/tag/V2wZv9aoze/","count":3},{"name":"SQL","slug":"zrXv1HrkU","used":true,"link":"https://Ro1ing.github.io/tag/zrXv1HrkU/","count":1},{"name":"PHP","slug":"T4AXz5C92","used":true,"link":"https://Ro1ing.github.io/tag/T4AXz5C92/","count":1},{"name":"反序列化","slug":"a1PMNYby40","used":true,"link":"https://Ro1ing.github.io/tag/a1PMNYby40/","count":1},{"name":"渗透","slug":"sqXwxlM5K","used":true,"link":"https://Ro1ing.github.io/tag/sqXwxlM5K/","count":1}],"menus":[{"link":"/","name":"首页","openType":"Internal"},{"link":"/archives","name":"归档","openType":"Internal"},{"link":"/tags","name":"标签","openType":"Internal"},{"link":"/post/about","name":"关于","openType":"External"}],"themeConfig":{"themeName":"Chic","postPageSize":10,"archivesPageSize":50,"siteName":"Ro1ing","siteDescription":"To be patient.","footerInfo":"Powered by <a href=\"https://github.com/getgridea/gridea\" target=\"_blank\">Gridea</a>","showFeatureImage":true,"domain":"https://Ro1ing.github.io","postUrlFormat":"SLUG","tagUrlFormat":"SHORT_ID","dateFormat":"YYYY-MM-DD","feedFullText":true,"feedCount":10,"archivesPath":"archives","postPath":"post","tagPath":"tag"},"customConfig":{"Valine":"off","author":"Ro1i","baidu":"on","bs":"","cdnSetting":"https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic","copyright":"on","description":"","donate":"off","donate_alipay":"https://blog.itjoker.cn/alipay.jpg","donate_wechat":"https://blog.itjoker.cn/wechat.jpg","facebook":"","friends":[{"description":"ITJoker's Blog","siteLink":"https://blog.itjoker.cn","siteLogo":"https://blog.itjoker.cn/images/avatar.png","siteName":"ITJoker"}],"ga":"","github":"https://github.com/Ro1ing","icpcode":"","icpinfo":"","instagram":"","keywords":"CTF","language":"en","linkedin":"","list":"on","live2d":"off","live2dDebug":"off","love_click_animation":"off","music":"on","musicModel":"fixed","musics":[{"author":"Guardin","description":"","name":"you don't know me anymore","siteLink":"","siteLogo":"","siteName":"","url":"http://music.163.com/song/media/outer/url?id=525239836"}],"platformLink":"https://coding.net","platformName":"Coding.net","prismSetting":"https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/css/Card/prism.min.css","qq":"434319061","rss":"","send":"","sentence":"on","siteFont":"-apple-system,BlinkMacSystemFont,'Helvetica Neue','PingFang SC','Hiragino Sans GB','Droid Sans Fallback','Microsoft YaHei',sans-serif","supportAuthor":"off","tumblr":"","twitter":"","update":"on","valineAppId":"Ikb4cFT8g3LbS49smmePHML3-gzGzoHsz","valineAppKey":"edbSbdN0QKg6KoA124V00rFG","valineAvatar":"mp","valineHighlight":false,"valinePageSize":10,"valinePlaceholder":"来都来了，不妨评论一下","valineRecordIp":false,"valineVisitor":false,"version":"1.7.6","view":"off","weather":"off","weibo":"","youtube":""},"utils":{"now":1611987981903}}